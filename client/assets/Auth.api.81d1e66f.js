import{c as M,a as F}from"./dom.8a48b212.js";import{c as b,h as G,r as h,V as k,a2 as O,a3 as Q,o as H,g as X,P as I,p as Z,Z as W,d as T,w as U,n as q,y as j,z as S,A as y,B as x,E as K,C as P,D as z,a6 as J}from"./index.cc854539.js";import{d as Y,a as D}from"./QPage.c1ad0483.js";import{v as ee}from"./QBtn.eaac0ed6.js";import{api as N}from"./axios.7f89e33a.js";import{eventBus as te,EVENT_AUTH as oe}from"./event-bus.3db7307f.js";var pe=M({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(d,{slots:f}){const o=b(()=>`q-card__section q-card__section--${d.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>G(d.tag,{class:o.value},F(f.default))}}),he=M({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(d,{slots:f,emit:o}){const u=X(),r=h(null);let c=0;const t=[];function s(e){const l=typeof e=="boolean"?e:d.noErrorFocus!==!0,_=++c,w=(i,m)=>{o("validation"+(i===!0?"Success":"Error"),m)},A=i=>{const m=i.validate();return typeof m.then=="function"?m.then(p=>({valid:p,comp:i}),p=>({valid:!1,comp:i,err:p})):Promise.resolve({valid:m,comp:i})};return(d.greedy===!0?Promise.all(t.map(A)).then(i=>i.filter(m=>m.valid!==!0)):t.reduce((i,m)=>i.then(()=>A(m).then(p=>{if(p.valid===!1)return Promise.reject(p)})),Promise.resolve()).catch(i=>[i])).then(i=>{if(i===void 0||i.length===0)return _===c&&w(!0),!0;if(_===c){const{comp:m,err:p}=i[0];if(p!==void 0&&console.error(p),w(!1,m),l===!0){const V=i.find(({comp:C})=>typeof C.focus=="function"&&ee(C.$)===!1);V!==void 0&&V.comp.focus()}}return!1})}function n(){c++,t.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function E(e){e!==void 0&&I(e);const l=c+1;s().then(_=>{l===c&&_===!0&&(d.onSubmit!==void 0?o("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function g(e){e!==void 0&&I(e),o("reset"),Z(()=>{n(),d.autofocus===!0&&d.noResetFocus!==!0&&v()})}function v(){Y(()=>{if(r.value===null)return;const e=r.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||r.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||r.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(r.value.querySelectorAll("[tabindex]"),l=>l.tabIndex>-1);e!=null&&e.focus({preventScroll:!0})})}k(W,{bindComponent(e){t.push(e)},unbindComponent(e){const l=t.indexOf(e);l>-1&&t.splice(l,1)}});let a=!1;return O(()=>{a=!0}),Q(()=>{a===!0&&d.autofocus===!0&&v()}),H(()=>{d.autofocus===!0&&v()}),Object.assign(u.proxy,{validate:s,resetValidation:n,submit:E,reset:g,focus:v,getValidationComponents:()=>t}),()=>G("form",{class:"q-form",ref:r,onSubmit:E,onReset:g},F(f.default))}});const R=5,L=255,ae=new RegExp(/^[\w\.-]+@[\w\.-]+\.\w+$/),$=8,B=128,se=new RegExp(/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&._-])[A-Za-z\d@$!%*#?&._-]{8,128}$/),ne="/auth/signin",re="/auth/signup",le={class:""},ge=T({__name:"EmailInput",setup(d,{expose:f}){const o=h(""),u=h(!1),r=h(!1),c=h("");U(o,(e,l)=>{u.value=e.length>0&&!v.value});function t(){u.value=!0}function s(){r.value=!0,c.value="This email is busy. try another or ",t()}function n(){r.value=!0,c.value="Email or password are invalid",t()}function E(){const e=!v.value;return e&&t(),!e}function g(){return o.value.toLowerCase().trim()}const v=b(()=>{const e=g();return ae.test(e)}),a=b(()=>{if(!u.value)return"";let e="Input should be valid email";const l=o.value;return l.length===0?e="Email should not be empty":l.length<R?e=`Email should be at least ${R} characters`:l.length>L?e=`Email should not be longer then ${L} symbols`:r.value&&(e=c.value),e});return f({validate:E,value:q(o),showEmailBusyError:s,showEmailNotFoundError:n}),(e,l)=>{const _=j("router-link");return S(),y(D,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=w=>o.value=w),label:"Email",type:"email",outlined:"","bottom-slots":"",error:u.value,maxlength:255},{error:x(()=>[K("span",le,[P(z(a.value)+" ",1),r.value?(S(),y(_,{key:0,to:"/signin",class:"text-purple"},{default:x(()=>[P("Sign In")]),_:1})):J("",!0)])]),_:1},8,["modelValue","error"])}}}),Ee=T({__name:"PasswordInput",setup(d,{expose:f}){const o=h(""),u=h(!1),r=h(!1),c=h("");U(o,(a,e)=>{u.value=a.length>0&&!g.value});function t(){u.value=!0}function s(){r.value=!0,c.value="Email or password are invalid",t()}function n(){const a=!g.value;return a&&t(),!a}function E(){return o.value.toLowerCase().trim()}const g=b(()=>{const a=E();return se.test(a)}),v=b(()=>{if(!u.value)return"";let a="";const e=o.value;return e.length===0?a="Password should not be empty":e.length<$?a=`Password should be at least ${$} characters`:e.match(/[A-Za-z]/)?e.match(/[0-9]/)?e.match(/[@$!%*#?&]/)?e.length>B?a=`Password should not be longer then ${B} symbols`:r.value&&(a=c.value):a="Password should include at least 1 special symbol: @$!%*#?&":a="Password should include at least 1 digit":a="Password should include at least 1 letter",a});return f({validate:n,value:q(o),showInvalidPasswordError:s}),(a,e)=>(S(),y(D,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value=l),label:"Password",type:"password",outlined:"","bottom-slots":"",error:u.value,maxlength:128},{error:x(()=>[P(z(v.value),1)]),_:1},8,["modelValue","error"]))}});class _e{static async register(f){const o=re,u=new AbortController,r=()=>{u.abort()};return{promise:N.post(o,f,{signal:u.signal}).then(t=>{const s=t.status,n=t.data;if(s===201&&n)return{status:s,data:n}}).catch(t=>{const s=t.response,n=s.status;if(n===409)return{status:n,data:null};console.error(s.status+": "+s.data)}),cancel:r}}static async login(f){const o=ne,u=new AbortController,r=()=>{u.abort()};return{promise:N.post(o,f,{signal:u.signal}).then(t=>{const s=t.status,n=t.data;if(s===201&&n)return te.emit(oe.LOGIN_SUCCESS,n),{status:s,data:n}}).catch(t=>{const s=t.response,n=s.status;if(n===404||n===401)return{status:n,data:null};console.error(s.status+": "+s.data)}),cancel:r}}}export{_e as A,pe as Q,ge as _,Ee as a,he as b};

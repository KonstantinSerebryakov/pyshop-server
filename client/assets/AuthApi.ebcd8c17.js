import{Q as $,p as Z}from"./throttle.591987d3.js";import{r as p,ay as A,d as k,w as B,c as G,o as H,D as Q,z as M,E as P,C as N,a0 as h,B as F,H as R,I as y,aA as j,u as J}from"./index.300c9223.js";import{H as f,A as C}from"./index.e92490f7.js";import{b as V,c as K,d as Y}from"./ApiConstants.4dae4bb1.js";import{eventBus as ee,EVENT_AUTH as se}from"./event-bus.c1fbaac4.js";import{A as L}from"./ApiService.a9cc5efe.js";const U=5,b=255,T=8,S=128,te=new RegExp(/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&._-])[A-Za-z\d@$!%*#?&._-]{8,128}$/);function D(){const m=p("ERROR"),i=p(""),a=p(!1);function n(e){m.value="ERROR",e&&(i.value=e),t()}function u(e){m.value="ERROR",e&&(i.value=e),t()}function t(){a.value=!0}function s(){a.value=!1}return{type:m,message:i,isShowMessage:A(a),showError:n,showInfo:u,show:t,hide:s}}const ae={class:""},ce=k({__name:"EmailInput",setup(m,{expose:i}){const a=D();function n(r){a.message.value=r}const u=a.isShowMessage,t=a.message,s=p(!1),e=p({to:"/",label:"/"}),d=p("");function g(){let r="Input should be valid email";const c=d.value;c.length===0?r="Email should not be empty":c.length<U?r=`Email should be at least ${U} characters`:c.length>b&&(r=`Email should not be longer then ${b} symbols`),n(r)}function w(){n("This email is busy. try another or ")}function _(){n("Email or password are invalid. New user? ")}function v(){e.value.to="/signin",e.value.label="Sign In"}function o(){e.value.to="/signup",e.value.label="Sign Up"}function l(){s.value=!0}function E(){s.value=!1}B(d,(r,c)=>{E(),r.length>0&&!x.value?(g(),a.show()):a.hide()});function I(){a.show()}function O(){w(),I(),v(),l()}function z(){_(),I(),o(),l()}function q(){const r=x.value;return r||I(),r}const x=G(()=>{const r=d.value.toLowerCase().trim(),{testPattern:c}=Z;return c.email(r)});return H(()=>{g()}),i({validate:q,value:A(d),showEmailBusyError:O,showEmailInvalidError:z}),(r,c)=>{const W=Q("router-link");return M(),P($,{modelValue:d.value,"onUpdate:modelValue":c[0]||(c[0]=X=>d.value=X),label:"Email",type:"email",outlined:"","bottom-slots":"",error:h(u),maxlength:h(b)},{error:N(()=>[F("span",ae,[R(y(h(t))+" ",1),s.value?(M(),P(W,{key:0,to:e.value.to,class:"text-purple"},{default:N(()=>[R(y(e.value.label),1)]),_:1},8,["to"])):j("",!0)])]),_:1},8,["modelValue","error","maxlength"])}}}),de=k({__name:"PasswordInput",setup(m,{expose:i}){const a=D();function n(o){a.message.value=o}const u=a.isShowMessage,t=a.message,s=p("");function e(){let o="";const l=s.value;l.length===0?o="Password should not be empty":l.length<T?o=`Password should be at least ${T} characters`:l.match(/[A-Za-z]/)?l.match(/[0-9]/)?l.match(/[@$!%*#?&]/)?l.length>S&&(o=`Password should not be longer then ${S} symbols`):o="Password should include at least 1 special symbol: @$!%*#?&":o="Password should include at least 1 digit":o="Password should include at least 1 letter",n(o)}function d(){n("Email or password are invalid.")}B(s,(o,l)=>{o.length>0&&!v.value?(e(),a.show()):a.hide()});function g(){a.show()}function w(){d(),g()}function _(){const o=v.value;return o||g(),o}const v=G(()=>{const o=s.value.toLowerCase().trim();return te.test(o)});return H(()=>{e()}),i({validate:_,value:A(s),showInvalidPasswordError:w}),(o,l)=>(M(),P($,{modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=E=>s.value=E),label:"Password",type:"password",outlined:"","bottom-slots":"",error:h(u),maxlength:h(S)},{error:N(()=>[R(y(h(t)),1)]),_:1},8,["modelValue","error","maxlength"]))}});class pe{static async register(i){const a=K,n=L.abortableRequest({method:"post",url:a,params:{[V]:!0},data:i}),u=n.requestPromise.then(t=>{const s=t.status,e=t.data;return s===f.Created&&e?{status:s,data:e}:{status:s,data:e}}).catch(t=>{if(t instanceof C&&t.response){const s=t.response.status,e=t.response.data;switch(s){case f.Conflict:break}return{status:s,data:e!=null?e:null}}return null});return{abort:n.abort,apiPromise:u}}static extractDeviceId(){return J().$state.deviceId}static async login(i){const a=Y,n=L.abortableRequest({method:"post",url:a,params:{[V]:!0},data:{...i,deviceId:this.extractDeviceId()}}),u=n.requestPromise.then(t=>{const s=t.status,e=t.data;return s===f.Created&&e?(ee.emit(se.LOGIN_SUCCESS,e),{status:s,data:e}):{status:s,data:null}}).catch(t=>{if(t instanceof C&&t.response){const s=t.response.status,e=t.response.data;switch(s){case f.NotFound:break;case f.Unauthorized:break}return{status:s,data:e!=null?e:null}}return Promise.resolve(null)});return{abort:n.abort,apiPromise:u}}}export{pe as A,ce as _,de as a};

import{c as k,h as q}from"./dom.e3c13c26.js";import{r as p,V as O,a3 as H,a8 as Q,o as z,h as X,g as W,P as R,q as Z,ag as j,d as M,w as F,c as w,p as G,y as K,z as x,A as P,B as A,u as T,E as J,C as V,D as U,ah as Y}from"./index.fda60f83.js";import{g as ee,Q as D}from"./QCardSection.345b1c98.js";import{f as te}from"./QBtn.b885109c.js";import{api as L}from"./axios.651c5204.js";import{e as oe,E as se}from"./event-bus.1e489e3b.js";const $=5,y=255,ae=new RegExp(/^[\w\.-]+@[\w\.-]+\.\w+$/),B=8,S=128,ne=new RegExp(/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&._-])[A-Za-z\d@$!%*#?&._-]{8,128}$/),re="/auth/signin",le="/auth/signup";var pe=k({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(f,{slots:m,emit:o}){const u=W(),r=p(null);let c=0;const t=[];function a(e){const l=typeof e=="boolean"?e:f.noErrorFocus!==!0,_=++c,b=(i,d)=>{o("validation"+(i===!0?"Success":"Error"),d)},C=i=>{const d=i.validate();return typeof d.then=="function"?d.then(h=>({valid:h,comp:i}),h=>({valid:!1,comp:i,err:h})):Promise.resolve({valid:d,comp:i})};return(f.greedy===!0?Promise.all(t.map(C)).then(i=>i.filter(d=>d.valid!==!0)):t.reduce((i,d)=>i.then(()=>C(d).then(h=>{if(h.valid===!1)return Promise.reject(h)})),Promise.resolve()).catch(i=>[i])).then(i=>{if(i===void 0||i.length===0)return _===c&&b(!0),!0;if(_===c){const{comp:d,err:h}=i[0];if(h!==void 0&&console.error(h),b(!1,d),l===!0){const I=i.find(({comp:N})=>typeof N.focus=="function"&&te(N.$)===!1);I!==void 0&&I.comp.focus()}}return!1})}function n(){c++,t.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function E(e){e!==void 0&&R(e);const l=c+1;a().then(_=>{l===c&&_===!0&&(f.onSubmit!==void 0?o("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function g(e){e!==void 0&&R(e),o("reset"),Z(()=>{n(),f.autofocus===!0&&f.noResetFocus!==!0&&v()})}function v(){ee(()=>{if(r.value===null)return;const e=r.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||r.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||r.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(r.value.querySelectorAll("[tabindex]"),l=>l.tabIndex>-1);e!=null&&e.focus({preventScroll:!0})})}O(j,{bindComponent(e){t.push(e)},unbindComponent(e){const l=t.indexOf(e);l>-1&&t.splice(l,1)}});let s=!1;return H(()=>{s=!0}),Q(()=>{s===!0&&f.autofocus===!0&&v()}),z(()=>{f.autofocus===!0&&v()}),Object.assign(u.proxy,{validate:a,resetValidation:n,submit:E,reset:g,focus:v,getValidationComponents:()=>t}),()=>X("form",{class:"q-form",ref:r,onSubmit:E,onReset:g},q(m.default))}});const ue={class:""},ge=M({__name:"EmailInput",setup(f,{expose:m}){const o=p(""),u=p(!1),r=p(!1),c=p("");F(o,(e,l)=>{u.value=e.length>0&&!v.value});function t(){u.value=!0}function a(){r.value=!0,c.value="This email is busy. try another or ",t()}function n(){r.value=!0,c.value="Email or password are invalid",t()}function E(){const e=!v.value;return e&&t(),!e}function g(){return o.value.toLowerCase().trim()}const v=w(()=>{const e=g();return ae.test(e)}),s=w(()=>{if(!u.value)return"";let e="Input should be valid email";const l=o.value;return l.length===0?e="Email should not be empty":l.length<$?e=`Email should be at least ${$} characters`:l.length>y?e=`Email should not be longer then ${y} symbols`:r.value&&(e=c.value),e});return m({validate:E,value:G(o),showEmailBusyError:a,showEmailNotFoundError:n}),(e,l)=>{const _=K("router-link");return x(),P(D,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=b=>o.value=b),label:"Email",type:"email",outlined:"","bottom-slots":"",error:u.value,maxlength:T(y)},{error:A(()=>[J("span",ue,[V(U(s.value)+" ",1),r.value?(x(),P(_,{key:0,to:"/signin",class:"text-purple"},{default:A(()=>[V("Sign In")]),_:1})):Y("",!0)])]),_:1},8,["modelValue","error","maxlength"])}}}),Ee=M({__name:"PasswordInput",setup(f,{expose:m}){const o=p(""),u=p(!1),r=p(!1),c=p("");F(o,(s,e)=>{u.value=s.length>0&&!g.value});function t(){u.value=!0}function a(){r.value=!0,c.value="Email or password are invalid",t()}function n(){const s=!g.value;return s&&t(),!s}function E(){return o.value.toLowerCase().trim()}const g=w(()=>{const s=E();return ne.test(s)}),v=w(()=>{if(!u.value)return"";let s="";const e=o.value;return e.length===0?s="Password should not be empty":e.length<B?s=`Password should be at least ${B} characters`:e.match(/[A-Za-z]/)?e.match(/[0-9]/)?e.match(/[@$!%*#?&]/)?e.length>S?s=`Password should not be longer then ${S} symbols`:r.value&&(s=c.value):s="Password should include at least 1 special symbol: @$!%*#?&":s="Password should include at least 1 digit":s="Password should include at least 1 letter",s});return m({validate:n,value:G(o),showInvalidPasswordError:a}),(s,e)=>(x(),P(D,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value=l),label:"Password",type:"password",outlined:"","bottom-slots":"",error:u.value,maxlength:T(S)},{error:A(()=>[V(U(v.value),1)]),_:1},8,["modelValue","error","maxlength"]))}});class _e{static async register(m){const o=le,u=new AbortController,r=()=>{u.abort()};return{promise:L.post(o,m,{signal:u.signal}).then(t=>{const a=t.status,n=t.data;if(a===201&&n)return{status:a,data:n}}).catch(t=>{const a=t.response,n=a.status;if(n===409)return{status:n,data:null};console.error(a.status+": "+a.data)}),cancel:r}}static async login(m){const o=re,u=new AbortController,r=()=>{u.abort()};return{promise:L.post(o,m,{signal:u.signal}).then(t=>{const a=t.status,n=t.data;if(a===201&&n)return oe.emit(se.LOGIN_SUCCESS,n),{status:a,data:n}}).catch(t=>{const a=t.response,n=a.status;if(n===404||n===401)return{status:n,data:null};console.error(a.status+": "+a.data)}),cancel:r}}}export{_e as A,pe as Q,ge as _,Ee as a};
